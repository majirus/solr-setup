<?xml version="1.0" encoding="UTF-8" ?>
<!-- This is the Solr schema file. This file should be named "schema.xml" and should be in the conf directory under the solr 
  home (i.e. ./solr/conf/schema.xml by default) or located where the classloader for the Solr webapp can find it. This example 
  schema is the recommended starting point for users. It should be kept correct and concise, usable out-of-the-box. For more 
  information, on how to customize this file, please see http://wiki.apache.org/solr/SchemaXml PERFORMANCE NOTE: this schema 
  includes many optional features and should not be used for benchmarking. To improve performance one could - set stored="false" 
  for all fields possible (esp large fields) when you only need to search on the field but don't need to return the original 
  value. - set indexed="false" if you don't need to search on the field, but only return the field as a result of searching 
  on other indexed fields. - remove all unneeded copyField statements - for best index size and searching performance, set 
  "index" to false for all general text fields, use copyField to copy them to the catchall "text" field, and use that for searching. 
  - For maximum indexing performance, use the StreamingUpdateSolrServer java client. - Remember to run the JVM in server mode, 
  and use a higher logging level that avoids logging every request -->

<schema name="pds_core_0" version="1.5">

  <fields>
    <!-- Valid attributes for fields: name: mandatory - the name for the field type: mandatory - the name of a field type 
      from the <types> fieldType section indexed: true if this field should be indexed (searchable or sortable) stored: true if 
      this field should be retrievable multiValued: true if this field may contain multiple values per document omitNorms: (expert) 
      set to true to omit the norms associated with this field (this disables length normalization and index-time boosting for 
      the field, and saves some memory). Only full-text fields or fields that need an index-time boost need norms. Norms are omitted 
      for primitive (non-analyzed) types by default. termVectors: [false] set to true to store the term vector for a given field. 
      When using MoreLikeThis, fields used for similarity should be stored for best performance. termPositions: Store position 
      information with the term vector. This will increase storage costs. termOffsets: Store offset information with the term vector. 
      This will increase storage costs. required: The field is required. It will throw an error if the value does not exist default: 
      a value that should be used if no value is specified when adding a document. -->
    <!-- field names should consist of alphanumeric or underscore characters only and not start with a digit. This is not 
      currently strictly enforced, but other field names will not have first class support from all components and back compatibility 
      is not guaranteed. Names with both leading and trailing underscores (e.g. _version_) are reserved. -->
    <!-- id genere automatiquement par solr(voir wiki uniqueKey) quand la valeur est NEW -->
    <!-- <field name="id" type="uuid" indexed="true" stored="true" default="NEW"/> -->
    <field name="intitule" type="texte_analyse" indexed="true" stored="true" />
    <field name="sid" type="texte_non_analyse" indexed="true" stored="true" required="true" />
    <field name="numero" type="texte_non_analyse" indexed="true" stored="true" multiValued="true" />
    <field name="id_status" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="datepublication" type="date" indexed="true" stored="true" />
    <field name="datecreation" type="date" indexed="true" stored="true" />
    <field name="datedemandepublication" type="date" indexed="true" stored="true" />
    <field name="datevalidation" type="date" indexed="true" stored="true" />
    <field name="datemodification" type="date" indexed="true" stored="true" />
    <field name="intitule_sort" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="texte" type="texte_analyse" indexed="true" stored="true" />
    <field name="texte_prestation_court" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="lieu" type="texte_analyse" indexed="true" stored="true" />
    <field name="ids_lieu" type="texte_analyse" indexed="true" stored="true" />
    <field name="niveau_experience" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="status_offre" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="nom_prenom_resp_apec" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="num_etablissement" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="nums_comptes_clients" type="texte_analyse" indexed="true" stored="true" />
    <field name="raisonSocial" type="texte_analyse" indexed="true" stored="true" />
    <field name="raisonSocial_sort" type="texte_non_analyse" indexed="true" stored="true" />
    <!-- TODO NEW reference_offre_client_non_analyse -->
    <field name="reference_offre_client_non_analyse" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="reference_offre_client" type="texte_analyse" indexed="true" stored="true" multiValued="true" />
    <field name="salaire_texte" type="texte_analyse" indexed="true" stored="true" />
    <field name="salaire_minimum" type="long" indexed="true" stored="true" />
    <field name="salaire_maximum" type="long" indexed="true" stored="true" />
    <field name="responsable_apec" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="id_centre" type="long" indexed="true" stored="true" />
    <field name="code_job" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="code_job_nomalized" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="code_secteur" type="texte_non_analyse" indexed="true" stored="true" />
    <field name="domiciliation" type="long" indexed="true" stored="true" />
    <field name="code_origine" type="long" indexed="true" stored="true" />
    <field name="reception_url" type="boolean" indexed="true" stored="true" />
    <field name="confidentielle" type="boolean" indexed="true" stored="true" />
    <field name="source_direct" type="boolean" indexed="true" stored="true" />
    <field name="id_type_contrat" type="long" indexed="true" stored="true" />
    <field name="id_salon" type="long" indexed="true" stored="true" />
    <field name="category" type="texte_category" indexed="true" stored="true" multiValued="true" />
  </fields>
  <!-- Field to use to determine and enforce document uniqueness. Unless this field is marked with required="false", it will 
    be a required field -->
  <uniqueKey>sid</uniqueKey>
  <types>
    <!-- field type definitions. The "name" attribute is just a label to be used by field definitions. The "class" attribute 
      and any other attributes determine the real behavior of the fieldType. Class names starting with "solr" refer to java classes 
      in a standard package such as org.apache.solr.analysis -->
    <!-- Universal Unique IDentifier (RFC 4122) generer automatiquement par Solr quand la valeur du field est NEW -->
    <!-- <fieldType name="uuid" class="solr.UUIDField" indexed="true" /> -->
    <!-- The StrField type is not analyzed, but indexed/stored verbatim. -->
    <fieldType name="texte_non_analyse" class="solr.StrField" />
    <!-- The format for this date field is of the form 1995-12-31T23:59:59Z -->
    <fieldType name="date" class="solr.TrieDateField" precisionStep="0" positionIncrementGap="0" />

    <!-- Default numeric field types. For faster range queries, consider the tint/tfloat/tlong/tdouble types. -->
    <fieldType name="long" class="solr.TrieLongField" precisionStep="0" positionIncrementGap="0" />
    <fieldType name="tlong" class="solr.TrieLongField" precisionStep="8" positionIncrementGap="0" />

    <!-- boolean type: "true" or "false" -->
    <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true" />
    <!-- A general text field that has reasonable, generic cross-language defaults: it tokenizes with StandardTokenizer, 
      removes stop words from case-insensitive "stopwords.txt" (empty by default), and down cases. At query time only, it also 
      applies synonyms. -->
    <fieldType name="texte_analyse" class="solr.TextField" positionIncrementGap="100">
      <analyzer>
        <tokenizer class="solr.StandardTokenizerFactory" />
        <!-- ajout du filtre des apostrophes -->
        <filter class="solr.ElisionFilterFactory" ignoreCase="true" articles="ellisionwords.txt" />
        <!-- convertir en minuscule -->
        <filter class="solr.LowerCaseFilterFactory" />
        <!-- marquer le token courant comme keyword sil apparait dans la liste keywords.txt il ne sera pas stemme -->
        <!-- <filter class="solr.KeywordMarkerFilterFactory" protected="keywords.txt"/> -->
        <!-- ne pas considerer ce jeton sil apparait dans stopwords.txt -->
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" enablePositionIncrements="true" />
        <!-- normalisation aux textes sans accents -->
        <filter class="solr.ASCIIFoldingFilterFactory" />
        <!-- filtre les accronymes -->
        <filter class="solr.StandardFilterFactory" />
        <!-- stemming des mots qui ne sont pas des keywords -->
        <filter class="solr.SnowballPorterFilterFactory" protected="protectedkeywords.txt" language="French" />

      </analyzer>
    </fieldType>
    <fieldType name="texte_category" stored="false" indexed="true" class="solr.TextField">
      <analyzer>
        <tokenizer class="solr.KeywordTokenizerFactory" />
        <filter class="solr.DelimitedPayloadTokenFilterFactory" encoder="float" />
      </analyzer>
    </fieldType>

  </types>
  <similarity class="fr.valtech.solr.library.CustomSimilarity" />
</schema>
